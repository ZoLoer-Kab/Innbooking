webpackJsonp([3],{0:function(e,t,n){e.exports=n(167)},91:function(e,t,n){"use strict";var o=n(13),i=function(){function e(){}return e.init=function(){if(void 0!==o.getPageData().clientConfiguration){var t=o.getPageData().clientConfiguration.ajaxRetryTimes,n=o.getPageData().clientConfiguration.ajaxRetryInterval;t&&n&&(e.ajaxRetryTimes=t,e.ajaxRetryInterval=n)}},e.ajaxRetryTimes=2,e.ajaxRetryInterval=500,e}();e.exports=i},92:function(e,t,n){(function(t){"use strict";var o=n(91),i=function(){function e(){}return e.load=function(){t.ajaxPrefilter(function(e,n,i){if(n.retryMax&&!(n.retryMax<=1)){n.retryCount?n.retryCount++:n.retryCount=1;var r=t.Deferred();return i.done(r.resolve),e.error=function(e,i,s){return n.retryCount>=n.retryMax?r.rejectWith(e):void setTimeout(function(){t.ajax(n).then(function(e){return r.resolve(e)}).fail(function(e,t,n){return r.rejectWith(e)})},o.ajaxRetryInterval)},r.promise(i)}})},e}();e.exports=i}).call(t,n(2))},116:function(e,t,n){(function(t){"use strict";var o=n(41),i=function(){function e(){this.combinedCardTypes=new Array,this.combinedCardTypes.push({name:"visa",displayName:"Visa",type:o.Visa}),this.combinedCardTypes.push({name:"mastercard",displayName:"MasterCard",type:o.MasterCard}),this.combinedCardTypes.push({name:"jcb",displayName:"JCB",type:o.Jcb}),this.combinedCardTypes.push({name:"americanexpress",displayName:"Amex",type:o.AmericanExpress})}return e.prototype.getCcofItems=function(){var e="/en-us/mmbccoflanding/ccofitems";return t.getJSON(e).then(function(e){return e.ccofItem})},e.prototype.add=function(e){var n="/en-us/mmbccoflanding/addCcof",o={name:e.cardHolderName(),number:e.cardNumber(),exmonth:e.expiryMonth(),exyear:e.expiryYear(),bank:e.issuingBank(),type:e.type()};return t.post(n,o)},e.prototype.edit=function(e){var n="/en-us/mmbccoflanding/updateCcof",o={cardId:e.cardId(),cardHolderName:e.cardHolderName(),exmonth:e.expiryMonth(),exyear:e.expiryYear(),issuingBankName:e.issuingBank()};return t.post(n,o)},e.prototype["delete"]=function(e){var n="/en-us/mmbccoflanding/deleteCcof";return t.post(n,{cardId:e})},e.prototype.deleteAll=function(){var e="/en-us/mmbccoflanding/deleteAllCcof";return t.post(e)},e.prototype.getDirectCreditCardList=function(){return this.combinedCardTypes},e}();e.exports=i}).call(t,n(2))},117:function(e,t){"use strict";var n;!function(e){var t;!function(e){e.ERROR_HTTP_CODE=417}(t=e.ccof||(e.ccof={}))}(n||(n={})),e.exports=n.ccof},161:function(e,t,n){(function(t){"use strict";var n=function(){function e(){}return e.load=function(){t.ajaxSetup({data:{__RequestVerificationToken:t("input[name='__RequestVerificationToken']").val()}})},e}();e.exports=n}).call(t,n(2))},167:function(e,t,n){(function(e,t){"use strict";var o=n(2);window.$=e=o,n(43),n(67),n(119),n(74),n(120),n(121),n(35),n(122);var i=n(7),r=n(10),s=n(32),a=n(88),c=n(13),l=n(91),d=n(92),u=n(168),p=n(161);o(document).ready(function(){i.load(),r.load(),l.init(),a.register(),s.register(),d.load(),p.load();var e=c.getPageData(),n=new u(e.jsonViewModel.ccofItem,e.jsonViewModel.addNewPaymentMethod,e.jsonViewModel.showMore,e.jsonViewModel.showLess,e.jsonViewModel.pollingWarningMessage);t.applyBindings(n)})}).call(t,n(2),n(4))},168:function(e,t,n){(function(t){"use strict";var o=n(117),i=n(116),r=function(){function e(e,n,o,r,s,a){void 0===a&&(a=new i),this.addNewPaymentMethod=n,this.showMore=o,this.showLess=r,this.pollingWarningMessage=s,this.ccofService=a,this.creditCardList=t.observableArray(e),this.showAll=t.observable(!1),this.isError=t.observable(!1),this.shouldHidePoolingWarningMessage=t.observable(!0),this.isDeleteAllProcessing=t.observable(!1),this.setupEventListeners(),this.updateFrameSize()}return e.prototype.displayCard=function(){var n=this;return t.computed(function(){return n.showAll()?n.creditCardList.slice(0):n.creditCardList.slice(0,e.limit)},this)},e.prototype.isShowMoreShowLessRequired=function(){return t.observable(this.creditCardList().length<=e.limit)},e.prototype.isShowAll=function(){return this.showAll()},e.prototype.addCcofForm=function(){parent.postMessage({addCcof:!0},"*")},e.prototype.ccofDeleteConfirm=function(e){parent.postMessage({deletingCardId:e.cardId},"*")},e.prototype.ccofEditForm=function(e){parent.postMessage({editCardId:e.cardId},"*")},e.prototype.toggleShowOption=function(){this.showAll(!this.showAll());var e=this.getRowCount(),t=this.getIsShowOption(),n=!this.shouldHidePoolingWarningMessage.peek(),o=this.calcNewHeight(e,t,n);parent.postMessage({ccofRowCount:e,newHeight:o},"*")},e.prototype.getRowCount=function(){var t=e.maxPerRow,n=Math.ceil((this.creditCardList().length+1)/t);return this.showAll()?n:n>t?t:n},e.prototype.getIsShowOption=function(){return this.creditCardList().length>e.limit},e.prototype.validateIframeEmbedding=function(){try{return window.self!==window.top}catch(e){return!1}},e.prototype.reloadCcofItems=function(){var e=this;return this.ccofService.getCcofItems().then(function(t){e.creditCardList(t),e.updateFrameSize()}).fail(function(t,n,i){t.status===o.ERROR_HTTP_CODE?e.handleSessionTimeout():parent.postMessage({errorReload:!0},"*")})},e.prototype.updateFrameSize=function(){var e=this.getRowCount(),t=this.getIsShowOption(),n=!this.shouldHidePoolingWarningMessage.peek(),o=this.calcNewHeight(e,t,n);parent.postMessage({ccofRowCount:e,newHeight:o},"*")},e.prototype.setupEventListeners=function(){var e=this,t=window.addEventListener?"addEventListener":"attachEvent",n=window[t],o="attachEvent"===t?"onmessage":"message";this.shouldHidePoolingWarningMessage.subscribe(function(){e.updateFrameSize()}),n(o,function(t){if(t.origin&&!(t.origin.indexOf(".agoda.com")<0)){var n=t.message?"message":"data",o=t[n];o&&(o.deletedCardId&&(e.creditCardList.remove(function(e){return e.cardId===o.deletedCardId}),e.updateFrameSize()),o.reload&&e.polling(),o.deleteAll&&e.deleteAll())}})},e.prototype.polling=function(t){var n=this;void 0===t&&(t=0);var o=this.creditCardList().length;this.reloadCcofItems().then(function(){var i=n.creditCardList().length;i<=o?++t<e.maxRetrys?setTimeout(function(){return n.polling(t)},1e3):n.shouldHidePoolingWarningMessage(!1):n.shouldHidePoolingWarningMessage(!0)},function(e){n.shouldHidePoolingWarningMessage(!0)})},e.prototype.deleteAll=function(){var e=this;this.isDeleteAllProcessing()||(this.isDeleteAllProcessing(!0),parent.postMessage({deleteAllProccessing:!0},"*"),this.ccofService.deleteAll().done(function(t){return e.isDeleteAllProcessing(!1),t&&t.IsSuccess?(parent.postMessage({deleteAllSuccess:!0},"*"),void e.reloadCcofItems()):void e.handleErrorCcofDeleteAll()}).fail(function(t,n,i){t.status===o.ERROR_HTTP_CODE?e.handleSessionTimeout():(e.isDeleteAllProcessing(!1),e.handleErrorCcofDeleteAll())}))},e.prototype.handleErrorCcofDeleteAll=function(){this.isError(!0),parent.postMessage({deleteAllError:!0},"*")},e.prototype.handleSessionTimeout=function(){parent.postMessage({refresh:!0},"*")},e.prototype.calcNewHeight=function(t,n,o){var i=e.panelHeight*t+(n?e.showOptionHeight:0)+(o?e.showPoolingWarningMsgHeight:0);return i},e.maxRetrys=4,e.maxPerRow=3,e.limit=8,e.panelHeight=172,e.showOptionHeight=20,e.showPoolingWarningMsgHeight=60,e}();e.exports=r}).call(t,n(4))}});